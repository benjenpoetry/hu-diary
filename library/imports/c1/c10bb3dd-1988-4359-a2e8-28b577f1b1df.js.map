{"version":3,"sources":["assets\\scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewScript extends cc.Component {\r\n\r\n    // 主角跳跃高度\r\n    @property\r\n    jumpHeight = 0;\r\n    // 主角跳跃持续时间\r\n    @property\r\n    jumpDuration = 0;\r\n    // 辅助形变动作时间\r\n    @property\r\n    squashDuration = 0;\r\n    // 最大移动速度\r\n    @property\r\n    maxMoveSpeed = 0;\r\n    // 加速度\r\n    @property\r\n    accel = 0;\r\n    // 跳跃音效资源\r\n    @property({\r\n        type: cc.AudioClip\r\n    })\r\n    jumpAudio = null;\r\n\r\n    // 加速度方向开关\r\n    accLeft = false;\r\n    accRight = false;\r\n\r\n    // 主角当前水平方向速度\r\n    xSpeed = 0;\r\n    // screen boundaries\r\n    minPosX = 0;\r\n    maxPosX = 0;\r\n\r\n    // 初始化跳跃动作\r\n    jumpAction = null;\r\n\r\n    // use this for initialization\r\n    onLoad () {\r\n        this.enabled = false;\r\n\r\n        // compute screen boundaries\r\n        this.minPosX = -this.node.parent.width/2;\r\n        this.maxPosX = this.node.parent.width/2;\r\n\r\n        // 初始化跳跃动作\r\n        this.jumpAction = this.runJumpAction();\r\n\r\n        // 初始化键盘输入监听\r\n        this.setInputControl();\r\n    }\r\n\r\n    setInputControl () {\r\n        //add keyboard input listener to jump, turnLeft and turnRight\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        // touch input\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_END, this.onTouchEnded, this);\r\n    }\r\n\r\n    onKeyDown (event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = true;\r\n                this.accRight = false;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                this.accLeft = false;\r\n                this.accRight = true;\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp (event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = false;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                this.accRight = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    onTouchBegan (event) {\r\n        var touchLoc = event.getLocation();\r\n        if (touchLoc.x >= cc.winSize.width/2) {\r\n            this.accLeft = false;\r\n            this.accRight = true;\r\n        } else {\r\n            this.accLeft = true;\r\n            this.accRight = false;\r\n        }\r\n        // don't capture the event\r\n        return true;\r\n    }\r\n\r\n    onTouchEnded (event) {\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n    }\r\n\r\n    runJumpAction () {\r\n        // 跳跃上升\r\n        var jumpUp = cc.tween().by(this.jumpDuration, { y: this.jumpHeight }, { easing: 'sineOut' });\r\n        // 下落\r\n        var jumpDown = cc.tween().by(this.jumpDuration, { y: -this.jumpHeight }, { easing: 'sineIn' });\r\n        // 形变\r\n        var squash = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 0.6 });\r\n        var stretch = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 1.2 });\r\n        var scaleBack = cc.tween().to(this.squashDuration, { scaleX: 1, scaleY: 1 });\r\n\r\n        // 创建一个缓动\r\n        var tween = cc.tween()\r\n                        // 按顺序执行动作\r\n                        .sequence(squash, stretch, jumpUp, scaleBack, jumpDown)\r\n                        // 添加一个回调函数，在前面的动作都结束时调用我们定义的 playJumpSound() 方法\r\n                        .call(this.playJumpSound, this);\r\n\r\n        // 不断重复\r\n        return cc.tween().repeatForever(tween);\r\n    }\r\n\r\n    playJumpSound () {\r\n        // 调用声音引擎播放声音\r\n        cc.audioEngine.playEffect(this.jumpAudio, false);\r\n    }\r\n\r\n    getCenterPos () {\r\n        var centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\r\n        return centerPos;\r\n    }\r\n\r\n    startMoveAt (pos) {\r\n        this.enabled = true;\r\n        this.xSpeed = 0;\r\n        this.node.setPosition(pos);\r\n        \r\n        var jumpAction = this.runJumpAction();\r\n        cc.tween(this.node).then(jumpAction).start()\r\n    }\r\n\r\n    stopMove () {\r\n        this.node.stopAllActions();\r\n    }\r\n\r\n    // called every frame\r\n    update (dt) {\r\n        // 根据当前加速度方向每帧更新速度\r\n        if (this.accLeft) {\r\n            this.xSpeed -= this.accel * dt;\r\n        } else if (this.accRight) {\r\n            this.xSpeed += this.accel * dt;\r\n        }\r\n        // 限制主角的速度不能超过最大值\r\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\r\n            // if speed reach limit, use max speed with current direction\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n        }\r\n\r\n        // 根据当前速度更新主角的位置\r\n        this.node.x += this.xSpeed * dt;\r\n\r\n        // limit player position inside screen\r\n        if ( this.node.x > this.node.parent.width/2) {\r\n            this.node.x = this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n        } else if (this.node.x < -this.node.parent.width/2) {\r\n            this.node.x = -this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n        }\r\n    }\r\n}\r\n"]}