{"version":3,"sources":["assets\\scripts\\Game.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mCAA8B;AAC9B,qCAAgC;AAChC,+BAA0B;AAEpB,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAuC,6BAAY;IAAnD;QAAA,qEA0NC;QAzNG,gBAAgB;QAIhB,gBAAU,GAAc,IAAI,CAAC;QAK7B,mBAAa,GAAc,IAAI,CAAC;QAEhC,iBAAiB;QAEjB,qBAAe,GAAG,CAAC,CAAC;QAEpB,qBAAe,GAAG,CAAC,CAAC;QAEpB,mBAAmB;QAInB,YAAM,GAAY,IAAI,CAAC;QAEvB,kCAAkC;QAClC;;WAEG;QAIH,YAAM,GAAW,IAAI,CAAC;QAEtB,kBAAkB;QAIlB,kBAAY,GAAa,IAAI,CAAC;QAE9B,SAAS;QAIT,gBAAU,GAAiB,IAAI,CAAC;QAKhC,aAAO,GAAY,IAAI,CAAC;QAKxB,kBAAY,GAAY,IAAI,CAAC;QAK7B,sBAAgB,GAAa,IAAI,CAAC;QAKlC,kBAAY,GAAG,EAAE,CAAC;QAKlB,eAAS,GAAG,EAAE,CAAC;QAEf,aAAO,GAAG,CAAC,CAAC;QAEZ,UAAU;QACV,iBAAW,GAAG,IAAI,CAAC;QACnB,kBAAY,GAAG,CAAC,CAAC;QACjB,WAAK,GAAG,CAAC,CAAC;QACV,kBAAY,GAAG,CAAC,CAAC;QACjB,eAAS,GAAG,KAAK,CAAC;QAClB,cAAQ,GAAI,IAAI,CAAC;QACjB,eAAS,GAAG,IAAI,CAAC;QACjB,WAAK,GAAG,CAAC,CAAC;;IA0Id,CAAC;IAzIG,8BAA8B;IAC9B,0BAAM,GAAN;QACI,eAAe;QACf,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAC,CAAC,CAAC;QAEpD,+BAA+B;QAC/B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QAEtB,SAAS;QACT,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QAEtB,kCAAkC;QAClC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QAEvB,0BAA0B;QAC1B,IAAI,QAAQ,GAAG,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC;QACpE,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,QAAQ,CAAC;QAExC,iCAAiC;QACjC,IAAI,CAAC,QAAQ,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACxC,IAAI,CAAC,SAAS,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAChD,CAAC;IAED,+BAAW,GAAX;QACI,QAAQ;QACR,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,4BAA4B;QAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,6CAA6C;QAC7C,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,KAAK,CAAC;QACjC,uCAAuC;QACvC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;QAChD,aAAa;QACb,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IAED,gCAAY,GAAZ;QACI;;WAEG;QACH,IAAI,OAAO,GAAG,IAAI,CAAC;QACnB,qBAAqB;QACrB,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;YAC1B,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,6CAA6C;SACnF;aAAM;YACH,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC7C;QACD,wBAAwB;QACxB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC5B,cAAc;QACd,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC;QAC/C,6BAA6B;QAC7B,OAAO,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtC,4CAA4C;QAC5C,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC;IAC/B,CAAC;IAED,+BAAW,GAAX,UAAa,IAAI;QACb,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACxB,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IAED,8BAAU,GAAV;QACI,oCAAoC;QACpC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC;QACzG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACnB,CAAC;IAED,sCAAkB,GAAlB;QACI,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,gCAAgC;QAChC,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,UAAU,GAAG,EAAE,CAAC;QAC9F,uBAAuB;QACvB,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAC,CAAC,CAAC;QAC7B,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;QACzC,SAAS;QACT,OAAO,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,6BAAS,GAAT,UAAW,GAAG;QACV,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC;QAChB,4BAA4B;QAC5B,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;QAC7D,OAAO;QACP,IAAI,EAAE,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAC7B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QAC5B,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACzB,EAAE,CAAC,IAAI,EAAE,CAAC;QACV,SAAS;QACT,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;IACnD,CAAC;IAED,8BAAU,GAAV;QACI,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;IACjE,CAAC;IAED,gCAAY,GAAZ;QACI,IAAI,EAAE,CAAC;QACP,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;YAC3B,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;YAC1B,OAAO,EAAE,CAAC,YAAY,CAAC,iBAAO,CAAC,CAAC;SACnC;aAAM;YACH,EAAE,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,iBAAO,CAAC,CAAC;YAC9D,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACd,OAAO,EAAE,CAAC;SACb;IACL,CAAC;IAED,kCAAc,GAAd,UAAgB,OAAO;QACnB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAChC,CAAC;IAED,qBAAqB;IACrB,0BAAM,GAAN,UAAQ,EAAE;QACN,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,OAAO;QAC5B,wBAAwB;QACxB,aAAa;QACb,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,YAAY,EAAE;YAChC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,OAAO;SACV;QACD,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC;IACrB,CAAC;IAED,4BAAQ,GAAR;QACG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC;QAChC,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,KAAK,CAAC;QAC5B,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QACvB,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;QAC3B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;IACtB,CAAC;IApND;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,MAAM;SAClB,CAAC;iDAC2B;IAK7B;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,MAAM;SAClB,CAAC;oDAC8B;IAIhC;QADC,QAAQ;sDACW;IAEpB;QADC,QAAQ;sDACW;IAMpB;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;SAChB,CAAC;6CACqB;IASvB;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,gBAAM;SACf,CAAC;6CACoB;IAMtB;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,KAAK;SACjB,CAAC;mDAC4B;IAM9B;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,SAAS;SACrB,CAAC;iDAC8B;IAKhC;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;SAChB,CAAC;8CACsB;IAKxB;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;SAChB,CAAC;mDAC2B;IAK7B;QAHC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,KAAK;SACjB,CAAC;uDACgC;IAKlC;QAHC,QAAQ,CAAC;YACN,SAAS,EAAE,IAAI;SAClB,CAAC;mDACgB;IAKlB;QAHC,QAAQ,CAAC;YACN,SAAS,EAAE,IAAI;SAClB,CAAC;gDACa;IApEE,SAAS;QAD7B,OAAO;OACa,SAAS,CA0N7B;IAAD,gBAAC;CA1ND,AA0NC,CA1NsC,EAAE,CAAC,SAAS,GA0NlD;kBA1NoB,SAAS","file":"","sourceRoot":"/","sourcesContent":["import Player from \"./Player\";\r\nimport ScoreFX from \"./ScoreFX\";\r\nimport Star from \"./Star\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewScript extends cc.Component {\r\n    // 这个属性引用了星星预制资源\r\n    @property({\r\n        type: cc.Prefab\r\n    })\r\n    starPrefab: cc.Prefab = null;\r\n        \r\n    @property({\r\n        type: cc.Prefab\r\n    })\r\n    scoreFXPrefab: cc.Prefab = null;\r\n            \r\n    // 星星产生后消失时间的随机范围\r\n    @property\r\n    maxStarDuration = 0;\r\n    @property\r\n    minStarDuration = 0;\r\n\r\n    // 地面节点，用于确定星星生成的高度\r\n    @property({\r\n        type: cc.Node\r\n    })\r\n    ground: cc.Node = null;\r\n    \r\n    // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n    /**\r\n     * @type {Player}\r\n     */\r\n    @property({\r\n        type: Player\r\n    })\r\n    player: Player = null;\r\n\r\n    // score label 的引用\r\n    @property({\r\n        type: cc.Label\r\n    })\r\n    scoreDisplay: cc.Label = null;\r\n    \r\n    // 得分音效资源\r\n    @property({\r\n        type: cc.AudioClip\r\n    })\r\n    scoreAudio: cc.AudioClip = null;\r\n        \r\n    @property({\r\n        type: cc.Node\r\n    })\r\n    btnNode: cc.Node = null;\r\n    \r\n    @property({\r\n        type: cc.Node\r\n    })\r\n    gameOverNode: cc.Node = null;\r\n\r\n    @property({\r\n        type: cc.Label\r\n    })\r\n    controlHintLabel: cc.Label = null;\r\n\r\n    @property({\r\n        multiline: true\r\n    })\r\n    keyboardHint = '';\r\n    \r\n    @property({\r\n        multiline: true\r\n    })\r\n    touchHint = '';\r\n\r\n    groundY = 0;\r\n\r\n    // private\r\n    currentStar = null;\r\n    currentStarX = 0;\r\n    timer = 0;\r\n    starDuration = 0;\r\n    isPlaying = false;\r\n    starPool =  null;\r\n    scorePool = null;\r\n    score = 0;\r\n    // use this for initialization\r\n    onLoad () {\r\n        // 获取地平面的 y 轴坐标\r\n        this.groundY = this.ground.y + this.ground.height/2;\r\n\r\n        // store last star's x position\r\n        this.currentStar = null;\r\n        this.currentStarX = 0;\r\n\r\n        // 初始化计时器\r\n        this.timer = 0;\r\n        this.starDuration = 0;\r\n\r\n        // is showing menu or running game\r\n        this.isPlaying = false;\r\n\r\n        // initialize control hint\r\n        var hintText = cc.sys.isMobile ? this.touchHint : this.keyboardHint;\r\n        this.controlHintLabel.string = hintText;\r\n\r\n        // initialize star and score pool\r\n        this.starPool = new cc.NodePool('Star');\r\n        this.scorePool = new cc.NodePool('ScoreFX');\r\n    }\r\n\r\n    onStartGame () {\r\n        // 初始化计分\r\n        this.resetScore();\r\n        // set game state to running\r\n        this.isPlaying = true;\r\n        // set button and gameover text out of screen\r\n        this.btnNode.x = 3000;\r\n        this.gameOverNode.active = false;\r\n        // reset player position and move speed\r\n        this.player.startMoveAt(cc.v2(0, this.groundY));\r\n        // spawn star\r\n        this.spawnNewStar();\r\n    }\r\n\r\n    spawnNewStar () {\r\n        /**\r\n         * @type {cc.Node}\r\n         */\r\n        var newStar = null;\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        if (this.starPool.size() > 0) {\r\n            newStar = this.starPool.get(this); // this will be passed to Star's reuse method\r\n        } else {\r\n            newStar = cc.instantiate(this.starPrefab);\r\n        }\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newStar);\r\n        // 为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        // pass Game instance to star\r\n        newStar.getComponent(Star).init(this);\r\n        // start star timer and store star reference\r\n        this.startTimer();\r\n        this.currentStar = newStar;\r\n    }\r\n\r\n    despawnStar (star) {\r\n        this.starPool.put(star);\r\n        this.spawnNewStar();\r\n    }\r\n\r\n    startTimer () {\r\n        // get a life duration for next star\r\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n    }\r\n\r\n    getNewStarPosition () {\r\n        var randX = 0;\r\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\r\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\r\n        // 根据屏幕宽度，随机得到一个星星 x 坐标\r\n        var maxX = this.node.width/2;\r\n        randX = (Math.random() - 0.5) * 2 * maxX;\r\n        // 返回星星坐标\r\n        return cc.v2(randX, randY);\r\n    }\r\n\r\n    gainScore (pos) {\r\n        this.score += 1;\r\n        // 更新 scoreDisplay Label 的文字\r\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\r\n        // 播放特效\r\n        var fx = this.spawnScoreFX();\r\n        this.node.addChild(fx.node);\r\n        fx.node.setPosition(pos);\r\n        fx.play();\r\n        // 播放得分音效\r\n        cc.audioEngine.play(this.scoreAudio, false, 1);\r\n    }\r\n\r\n    resetScore () {\r\n        this.score = 0;\r\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\r\n    }\r\n\r\n    spawnScoreFX () {\r\n        var fx;\r\n        if (this.scorePool.size() > 0) {\r\n            fx = this.scorePool.get();\r\n            return fx.getComponent(ScoreFX);\r\n        } else {\r\n            fx = cc.instantiate(this.scoreFXPrefab).getComponent(ScoreFX);\r\n            fx.init(this);\r\n            return fx;\r\n        }\r\n    }\r\n\r\n    despawnScoreFX (scoreFX) {\r\n        this.scorePool.put(scoreFX);\r\n    }\r\n\r\n    // called every frame\r\n    update (dt) {\r\n        if (!this.isPlaying) return;\r\n        // 每帧更新计时器，超过限度还没有生成新的星星\r\n        // 就会调用游戏失败逻辑\r\n        if (this.timer > this.starDuration) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n        this.timer += dt;\r\n    }\r\n\r\n    gameOver () {\r\n       this.gameOverNode.active = true;\r\n       this.player.enabled = false;\r\n       this.player.stopMove();\r\n       this.currentStar.destroy();\r\n       this.isPlaying = false;\r\n       this.btnNode.x = 0;\r\n    }\r\n}\r\n"]}